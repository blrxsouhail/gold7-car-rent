{% extends "base.html" %}

{% block title %}Modifier Client - Gold 7 Car Rent{% endblock %}

{% block page_icon %}<i class="fas fa-user-edit"></i>{% endblock %}
{% block page_title %}‚úèÔ∏è Modifier Client{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('clients') }}">üë• Clients</a></li>
<li class="breadcrumb-item active">‚úèÔ∏è Modifier</li>
{% endblock %}

{% block page_actions %}
<a href="{{ url_for('clients') }}" class="btn btn-outline-secondary">
    <i class="fas fa-arrow-left me-2"></i>‚¨ÖÔ∏è Retour √† la liste
</a>
{% endblock %}

{% block content %}
<form method="POST" enctype="multipart/form-data" class="form-modern">
    <div class="row">
        <!-- Informations personnelles -->
        <div class="col-lg-6">
            <div class="card-modern mb-4">
                <div class="card-header-modern">
                    <h5 class="mb-0"><i class="fas fa-user me-2"></i>üë§ Informations Personnelles</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nom" class="form-label">Nom *</label>
                            <input type="text" class="form-control" id="nom" name="nom" value="{{ client.nom }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="prenom" class="form-label">Pr√©nom *</label>
                            <input type="text" class="form-control" id="prenom" name="prenom" value="{{ client.prenom }}" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="date_naissance" class="form-label">Date de Naissance *</label>
                            <input type="date" class="form-control" id="date_naissance" name="date_naissance" 
                                   value="{{ client.date_naissance.strftime('%Y-%m-%d') if client.date_naissance else '' }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="lieu_naissance" class="form-label">Lieu de Naissance</label>
                            <input type="text" class="form-control" id="lieu_naissance" name="lieu_naissance" 
                                   value="{{ client.lieu_naissance or '' }}">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nationalite" class="form-label">Nationalit√©</label>
                            <input type="text" class="form-control" id="nationalite" name="nationalite" 
                                   value="{{ client.nationalite or 'Marocaine' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="sexe" class="form-label">Sexe</label>
                            <select class="form-control" id="sexe" name="sexe">
                                <option value="">S√©lectionner</option>
                                <option value="M" {{ 'selected' if client.sexe == 'M' else '' }}>Masculin</option>
                                <option value="F" {{ 'selected' if client.sexe == 'F' else '' }}>F√©minin</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="profession" class="form-label">Profession</label>
                            <input type="text" class="form-control" id="profession" name="profession" 
                                   value="{{ client.profession or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="entreprise" class="form-label">Entreprise</label>
                            <input type="text" class="form-control" id="entreprise" name="entreprise" 
                                   value="{{ client.entreprise or '' }}">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Coordonn√©es -->
        <div class="col-lg-6">
            <div class="card-modern mb-4">
                <div class="card-header-modern">
                    <h5 class="mb-0"><i class="fas fa-address-book me-2"></i>üìû Coordonn√©es</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="telephone" class="form-label">T√©l√©phone *</label>
                            <input type="tel" class="form-control" id="telephone" name="telephone" 
                                   value="{{ client.telephone }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" 
                                   value="{{ client.email or '' }}">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="adresse" class="form-label">Adresse *</label>
                        <textarea class="form-control" id="adresse" name="adresse" rows="3" required>{{ client.adresse }}</textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="ville" class="form-label">Ville *</label>
                            <input type="text" class="form-control" id="ville" name="ville" 
                                   value="{{ client.ville }}" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="code_postal" class="form-label">Code Postal</label>
                            <input type="text" class="form-control" id="code_postal" name="code_postal" 
                                   value="{{ client.code_postal or '' }}">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="pays" class="form-label">Pays</label>
                            <input type="text" class="form-control" id="pays" name="pays" 
                                   value="{{ client.pays or 'Maroc' }}">
                        </div>
                    </div>
                    
                    <hr>
                    <h6><i class="fas fa-phone-alt me-2"></i>üö® Contact d'Urgence</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="personne_contact_urgence" class="form-label">Nom du Contact</label>
                            <input type="text" class="form-control" id="personne_contact_urgence" name="personne_contact_urgence" 
                                   value="{{ client.personne_contact_urgence or '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="telephone_urgence" class="form-label">T√©l√©phone d'Urgence</label>
                            <input type="tel" class="form-control" id="telephone_urgence" name="telephone_urgence" 
                                   value="{{ client.telephone_urgence or '' }}">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Documents d'identit√© -->
        <div class="col-lg-6">
            <div class="card-modern mb-4">
                <div class="card-header-modern">
                    <h5 class="mb-0"><i class="fas fa-id-card me-2"></i>üÜî Pi√®ce d'Identit√©</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="type_piece_identite" class="form-label">Type de Pi√®ce *</label>
                            <select class="form-control" id="type_piece_identite" name="type_piece_identite" required>
                                <option value="">S√©lectionner</option>
                                <option value="CIN" {{ 'selected' if client.type_piece_identite == 'CIN' else '' }}>Carte d'Identit√© Nationale</option>
                                <option value="Passeport" {{ 'selected' if client.type_piece_identite == 'Passeport' else '' }}>Passeport</option>
                                <option value="Carte de s√©jour" {{ 'selected' if client.type_piece_identite == 'Carte de s√©jour' else '' }}>Carte de S√©jour</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="numero_piece_identite" class="form-label">Num√©ro *</label>
                            <input type="text" class="form-control" id="numero_piece_identite" name="numero_piece_identite" 
                                   value="{{ client.numero_piece_identite }}" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="date_expiration_piece" class="form-label">Date d'Expiration</label>
                        <input type="date" class="form-control" id="date_expiration_piece" name="date_expiration_piece" 
                               value="{{ client.date_expiration_piece.strftime('%Y-%m-%d') if client.date_expiration_piece else '' }}">
                        <small class="form-text text-muted">Laisser vide si la pi√®ce n'expire pas</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="photo_piece_identite" class="form-label">Photo de la Pi√®ce d'Identit√©</label>
                        <input type="file" class="form-control" id="photo_piece_identite" name="photo_piece_identite" 
                               accept="image/*,.pdf">
                        <small class="form-text text-muted">Formats accept√©s: JPG, PNG, PDF (Max: 16MB)</small>
                        {% if client.photo_piece_identite %}
                        <div class="mt-2">
                            <small class="text-success">‚úÖ Document actuel: {{ client.photo_piece_identite }}</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Permis de conduire -->
        <div class="col-lg-6">
            <div class="card-modern mb-4">
                <div class="card-header-modern">
                    <h5 class="mb-0"><i class="fas fa-car me-2"></i>üöó Permis de Conduire</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="numero_permis" class="form-label">Num√©ro de Permis *</label>
                            <input type="text" class="form-control" id="numero_permis" name="numero_permis" 
                                   value="{{ client.numero_permis }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="categorie_permis" class="form-label">Cat√©gorie</label>
                            <select class="form-control" id="categorie_permis" name="categorie_permis">
                                <option value="B" {{ 'selected' if client.categorie_permis == 'B' else '' }}>B (Voiture)</option>
                                <option value="A" {{ 'selected' if client.categorie_permis == 'A' else '' }}>A (Moto)</option>
                                <option value="C" {{ 'selected' if client.categorie_permis == 'C' else '' }}>C (Camion)</option>
                                <option value="D" {{ 'selected' if client.categorie_permis == 'D' else '' }}>D (Bus)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="date_obtention_permis" class="form-label">Date d'Obtention *</label>
                            <input type="date" class="form-control" id="date_obtention_permis" name="date_obtention_permis" 
                                   value="{{ client.date_obtention_permis.strftime('%Y-%m-%d') if client.date_obtention_permis else '' }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="date_expiration_permis" class="form-label">Date d'Expiration *</label>
                            <input type="date" class="form-control" id="date_expiration_permis" name="date_expiration_permis" 
                                   value="{{ client.date_expiration_permis.strftime('%Y-%m-%d') if client.date_expiration_permis else '' }}" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="pays_delivrance_permis" class="form-label">Pays de D√©livrance</label>
                        <input type="text" class="form-control" id="pays_delivrance_permis" name="pays_delivrance_permis" 
                               value="{{ client.pays_delivrance_permis or 'Maroc' }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="photo_permis" class="form-label">Photo du Permis de Conduire</label>
                        <input type="file" class="form-control" id="photo_permis" name="photo_permis" 
                               accept="image/*,.pdf">
                        <small class="form-text text-muted">Formats accept√©s: JPG, PNG, PDF (Max: 16MB)</small>
                        {% if client.photo_permis %}
                        <div class="mt-2">
                            <small class="text-success">‚úÖ Document actuel: {{ client.photo_permis }}</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notes -->
    <div class="card-modern mb-4">
        <div class="card-header-modern">
            <h5 class="mb-0"><i class="fas fa-sticky-note me-2"></i>üìù Notes et Commentaires</h5>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label for="notes" class="form-label">Notes</label>
                <textarea class="form-control" id="notes" name="notes" rows="4" 
                          placeholder="Informations compl√©mentaires, remarques particuli√®res...">{{ client.notes or '' }}</textarea>
            </div>
        </div>
    </div>
    
    <!-- Boutons d'action -->
    <div class="card-modern">
        <div class="card-body">
            <div class="d-flex justify-content-between">
                <a href="{{ url_for('clients') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-times me-2"></i>‚ùå Annuler
                </a>
                <button type="submit" class="btn btn-primary-modern">
                    <i class="fas fa-save me-2"></i>üíæ Sauvegarder les Modifications
                </button>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
// Validation du formulaire
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const dateNaissance = document.getElementById('date_naissance');
    const dateObtentionPermis = document.getElementById('date_obtention_permis');
    const dateExpirationPermis = document.getElementById('date_expiration_permis');
    
    // Validation de l'√¢ge minimum (18 ans)
    dateNaissance.addEventListener('change', function() {
        const today = new Date();
        const birthDate = new Date(this.value);
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        
        if (age < 18) {
            alert('Le client doit avoir au moins 18 ans.');
            this.value = '';
        }
    });
    
    // Validation des dates de permis
    dateObtentionPermis.addEventListener('change', function() {
        const birthDate = new Date(dateNaissance.value);
        const licenseDate = new Date(this.value);
        
        if (birthDate && licenseDate < birthDate) {
            alert('La date d\'obtention du permis ne peut pas √™tre ant√©rieure √† la date de naissance.');
            this.value = '';
        }
    });
    
    dateExpirationPermis.addEventListener('change', function() {
        const obtentionDate = new Date(dateObtentionPermis.value);
        const expirationDate = new Date(this.value);
        
        if (obtentionDate && expirationDate <= obtentionDate) {
            alert('La date d\'expiration doit √™tre post√©rieure √† la date d\'obtention.');
            this.value = '';
        }
    });
});
</script>
{% endblock %}
